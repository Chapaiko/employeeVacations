<!DOCTYPE html>
<html>
    <head>
        <title>Vacation Calendar</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="//aui-cdn.atlassian.com/aui-adg/6.0.7/css/aui.min.css" media="all">
        <link rel="stylesheet" href="//aui-cdn.atlassian.com/aui-adg/6.0.7/css/aui-experimental.min.css" media="all">

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script src="//aui-cdn.atlassian.com/aui-adg/6.0.7/js/aui.min.js"></script>
        <script src="//aui-cdn.atlassian.com/aui-adg/6.0.7/js/aui-experimental.min.js"></script>
        <script src="//aui-cdn.atlassian.com/aui-adg/6.0.7/js/aui-datepicker.min.js"></script>
        <script src="//aui-cdn.atlassian.com/aui-adg/6.0.7/js/aui-soy.min.js"></script>

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    </head>
    <body>
        <div>
            <label for="Account" style="margin-left: 10px;" >Account</label>
                <select name="Account" style="margin-left: 5px;">
                    <option>aa</option>
                    <option>ab</option>
                    <option>ac</option>
                    <option>ad</option>
                    <option>ae</option>
                </select>
            <label for="Department" style="margin-left: 10px;" >Department</label>
            <select name="Department" style="margin-left: 5px;" >
                <option>da</option>
                <option>db</option>
                <option>dc</option>
                <option>dd</option>
                <option>de</option>
            </select>
                <label for="Name" style="margin-left: 10px;" >Name</label>
                <input type="text" name="Name" value="" size="25" style="margin-left: 5px;" />
                <input type="button" value="Filter" name="filter" style="margin-left: 10px;" />
            </div>
        </div>
        <div id="vacationContainer" class="tempo-timesheet-table" style="height:500px ;" >

        </div>
              <div id="vacationContainerA" class="content-container tt-content-container" >
                    <div class="tempo-table tempo-timesheet iss-nav header-target">
                        <div class="header-container shadowed-header">
                            <table id="vacationTable" class="tempo-timesheet-table">
                                <thead>
                                    <tr class="rowHeader" >
        
                                    </tr>
                                    <tr class="rowHeader" >
        
                                    </tr>
                                </thead>
                                <tbody>
        
                                </tbody>
                                <tfoot>
        
                                </tfoot>
                            </table>
                        </div>
                    </div>        
                </div>
        <script >
            class UsageOptions {
                constructor(resetOn, availableDays, totalDays) {
                    this._resetOn = resetOn;
                    this._availableDays = availableDays;
                    this._totalDays = totalDays;
                }
            }
            class Vacation {
                constructor(name, employee, description, vacationStart, vacationEnd, resolution) {
                    this._name = name;
                    this._employee = employee;
                    this._description = description;
                    this._vacationStart = vacationStart;
                    this._vacationEnd = vacationEnd;
                    this._resolution = resolution;
                }
            }

            class EmployeeWithVacations {
                constructor(name) {
                    this._vacations = new Set();
                    this._name = name;
                }

                addVacation(addedVacation) {
                    this._vacations.add(addedVacation);
                }
            }

            var currentUsageOptions = new UsageOptions();
            var employeeArray = new Array();
            var employeesWithVacationsArray = new Array();
            var inputData = new Object();
            var vacationsList = [];
            var scopedVacationList = [];


            function getJSONData() {
                $.getJSON("data/vacation.json", function (json) {
                    inputData = json;
                    console.log(inputData);
                    currentUsageOptions = new UsageOptions(new Date(inputData.usage.resetOn), inputData.usage.availableDays, inputData.usage.totalDays);
                    console.log(currentUsageOptions);
                    manageVacations();
                });
            }

            function manageVacations() {
                //let employeeSet = new Set();
                for (var i in inputData.calendar) {
                    vacationsList.push(new Vacation(
                            inputData.calendar[i].Name,
                            inputData.calendar[i].Employee,
                            inputData.calendar[i].Description,
                            new Date(inputData.calendar[i].VacationStart),
                            new Date(inputData.calendar[i].VacationEnd),
                            inputData.calendar[i].Resolution));
                    //console.log(vacationsList[i]);
                    //employeeSet.add(inputData.calendar[i].Employee);
                }
                vacationsList.sort();
                for (var vac in vacationsList) {
                    if (vacationsList[vac]._vacationStart >= currentUsageOptions._resetOn && vacationsList[vac]._vacationEnd <= currentUsageOptions._resetOn) {

                    }
                }
//                console.log(employeeSet);
//                employeeArray = Array.from(employeeSet).sort();
//                console.log(employeeArray);
//                for (var emp in employeeArray) {
//                    let tempEmployeeWithVacations = new EmployeeWithVacations(employeeArray[emp]);
//                    for (var vac in vacationsList) {
//                        //console.log(tempEmployeeWithVacations._name);
//                        if (tempEmployeeWithVacations._name === vacationsList[vac]._employee) {
//                            tempEmployeeWithVacations.addVacation(vacationsList[vac]);
//                        }
//                    }
//                    employeesWithVacationsArray.push(tempEmployeeWithVacations);
//                }
            }

            function drawChart() {
                var container = document.getElementById('vacationContainer');
                var chart = new google.visualization.Timeline(container);
                var colorMap = new Map();
                colorMap.set('In Review', 'yellow');
                colorMap.set('Approved', 'green');
                var dataTable = new google.visualization.DataTable();
                dataTable.addColumn({type: 'string', id: 'Employee'});
                dataTable.addColumn({type: 'string', id: 'Resolution'});
                dataTable.addColumn({type: 'string', role: 'tooltip'});
                dataTable.addColumn({type: 'date', id: 'Start'});
                dataTable.addColumn({type: 'date', id: 'End'});
                dataTable.addColumn({type: 'string', role: 'style'});
                for (var emp in vacationsList) {
                    dataTable.addRow(
                            [vacationsList[emp]._employee,
                                vacationsList[emp]._resolution,
                                vacationsList[emp]._name + ' ' + vacationsList[emp]._description,
                                vacationsList[emp]._vacationStart,
                                vacationsList[emp]._vacationEnd,
                                'color: ' + colorMap.get(vacationsList[emp]._resolution)
                            ]);
                }
                var tempMaxDate = new Date(currentUsageOptions._resetOn);
                tempMaxDate.setDate(tempMaxDate.getDate() + currentUsageOptions._totalDays);
                var options = {
                    timeline: {

                        showRowLabels: true,
                        groupByRowLabel: true},
                    colors: ['yellow', 'green'],
                    hAxis: {
                        minValue: new Date(2017, 3, 1),
                        maxValue: new Date(2017, 5, 1)
                    }
                };
                var view = new google.visualization.DataView(dataTable);
                chart.draw(dataTable, options);

            }

            window.onload = function () {
                getJSONData();
                google.charts.load('current', {'packages': ['timeline']});
                google.charts.setOnLoadCallback(drawChart);
            }
        </script>
    </body>
</html>
